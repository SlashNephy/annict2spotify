version: '3.8'

services:
  db:
    # https://hub.docker.com/_/postgres
    image: postgres:14.6-bullseye
    restart: always
    environment:
      POSTGRES_USER: ${DATABASE_USER}
      POSTGRES_PASSWORD: ${DATABASE_PASSWORD}
    ports:
      - '5432:5432/tcp'
    volumes:
      - db:/var/lib/postgresql

  app:
    image: node:20.18.0-bullseye-slim@sha256:9b558df8f10198fcd1f48cf344c55c4442c3446b8a9a69487523b3d890a4a59e
    restart: always
    depends_on:
      - db
    command: 'sh -c "apt-get update -y && apt-get install -y openssl && yarn && yarn generate && yarn dev"'
    working_dir: /app
    volumes:
      - ./:/app
    ports:
      - '3000:3000/tcp'

volumes:
  db:
